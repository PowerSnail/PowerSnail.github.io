<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https://snailshell.goatcounter.com/count https://mirrors.creativecommons.org/; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
    <meta name="author" content="PowerSnail">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#af3000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="theme-color" content="#1C4652">
    <title>
      Gradient Detection Convolutions, Seam Carving, and Patch March · SnailShell
    </title>
    <link rel="prefetch" href="/images/front-cover.webp" as="image" crossorigin="">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="canonical" href="https://powersnail.com/2016/image-manipulation/">
  </head>
  <body>
    <header>
      <a href="/">SnailShell</a>
      <nav>
        <a type="button" href="/posts/">Posts</a> <a type="button" href="/status/">Status</a> <a type="button" href="/about/">About</a>
      </nav>
    </header><img class="goatcounter" alt="" width="1" height="1" src="https://snailshell.goatcounter.com/count?p=%2f2016%2fimage-manipulation%2f&amp;t=Gradient%20Detection%20Convolutions%2c%20Seam%20Carving%2c%20and%20Patch%20March">
    <main>
      <article>
        <h1>
          Gradient Detection Convolutions, Seam Carving, and Patch March
        </h1>
        <hr>
        <div id="metadata">
          <span class="icon-prefix calendar-event">2016-11-03</span> <span class="icon-prefix calculator">781 words</span> <span class="icon-prefix clock">4 minutes read</span>
        </div>
        <h2 id="gradient-detection-convolutions">
          Gradient detection convolutions
        </h2>
        <p>
          Square instead of rectangle: to avoid problems concerning diagonal
        </p>
        <ul>
          <li>usually 3 x 3
          </li>
        </ul>
        <h2 id="edge-detection">
          edge detection
        </h2>
        <ul>
          <li>apply gradient detection convolution
          </li>
          <li>find where gradient appears
          </li>
        </ul>
        <div class="highlight">
          <pre class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> / \    / \    / \   / \
</span></span><span class="line"><span class="cl">  |      |      |     |
</span></span><span class="line"><span class="cl"> _____________________________  &lt;- at this line, the gradient is extreme
</span></span><span class="line"><span class="cl"> ******************************
</span></span><span class="line"><span class="cl"> ******************************
</span></span><span class="line"><span class="cl"> ******************************</span></span></code></pre>
        </div>
        <ul>
          <li>find maximum gradient points
          </li>
          <li>edge is perpendicular to gradients
          </li>
        </ul>
        <h2 id="segmentation-intelligent-scissors">
          Segmentation: Intelligent Scissors
        </h2>
        <p>
          INPUT: a set of points OUTPUT: find a path(curve) that is following edge as much as possible
        </p>
        <p>
          This is a graph traversal problem. Each pixel has some neighbors, and we choose points based on gradient at each point.
        </p>
        <p>
          ALGORITHM
        </p>
        <ul>
          <li>treat the picture as a graph
          </li>
          <li>each pixel is connected to neighboring pixels
          </li>
          <li>cost minimization
            <ul>
              <li>cost = 1 - gradient // higher gradient, better to choose
              </li>
              <li>optionally, cost for diagonal is higher, etc.
              </li>
            </ul>
          </li>
          <li>simply adding up cost of each step
          </li>
        </ul>
        <h2 id="segmentation-k-means">
          Segmentation: k-means
        </h2>
        <p>
          automatic algorithm: k neighbor
        </p>
        <p>
          It finds pixels that are close in color-space & geometry, and connect them. By tweaking the weight of adjacency and color-space closeness, we can have different results. This can be used in color reduction. It reduces the amount of gradient exists in the graph.
        </p>
        <p>
          <a href="https://en.wikipedia.org/wiki/Image_segmentation">Segmentation</a>
        </p>
        <h2 id="image-processing-algorithms-machine-learning">
          Image Processing Algorithms: Machine Learning
        </h2>
        <h3 id="machine-learning-model">
          Machine Learning Model
        </h3>
        <p>
          A black box, that takes in independent and dependent vars, and output a function that describes the relationship between those.
        </p>
        <p>
          $$Black-Box(x, y) \to y = f(x)$$
        </p>
        <h3 id="in-image-processing">
          In Image Processing
        </h3>
        <ul>
          <li>Independent var: features of the image
          </li>
          <li>Dependent var: classification(is it a dog?)
          </li>
        </ul>
        <p>
          To find features, we try to find patterns of gradient in the image.
        </p>
        <p>
          There are parts of the image that are more informative than others. It contains patterns that are robust against small changes. It will be stable across different images sharing the same pattern, despite small differences.
        </p>
        <p>
          This could be represented by:
        </p>
        <ul>
          <li>maxima of gradient
          </li>
          <li>area of gradient turns
          </li>
        </ul>
        <p>
          These are works for feature detection algorithms.
        </p>
        <p>
          For example, a gray box.
        </p>
        <p>
          This is easily identified, because the right angles of the square corners are a robust feature. The change in gradient pattern is consistent in different images.
        </p>
        <h2 id="seam-carving">
          Seam Carving
        </h2>
        <ul>
          <li>INPUT: Image
          </li>
          <li>OUTPUT: Smaller image, that does not look distorted.
          </li>
        </ul>
        <p>
          Requirement:
        </p>
        <ul>
          <li>focus objects are in frame
          </li>
          <li>no obvious distortion
          </li>
          <li>only boring parts are cut off
          </li>
        </ul>
        <p>
          <a href="https://en.wikipedia.org/wiki/Seam_carving">Seam Carving</a>
        </p>
        <p>
          Use magnitude of gradient to approximate the “interestingness”.
        </p>
        <ul>
          <li>large gradient: an object -&gt; interest
          </li>
          <li>low gradient: same across image -&gt; less information
          </li>
        </ul>
        <p>
          In order to get a better estimate, we might need to blur the image a little bit.
        </p>
        <p>
          <em>NOTE: the reason that the gradient image on Wikipedia has squares is because JPEG compression</em>
        </p>
        <p>
          <strong>How to decide what to remove?</strong>
        </p>
        <p>
          In order to narrow an image for 1 pixel, every row needs to be smaller by 1 pixel.
        </p>
        <ol>
          <li>For each row, pick the least interesting pixel
          </li>
        </ol>
        <ul>
          <li>[FAILED]
          </li>
          <li>line shifts, and the image will be distorted
          </li>
        </ul>
        <ol start="2">
          <li>Select one vertical line
          </li>
        </ol>
        <ul>
          <li>[FAILED]
          </li>
          <li>This will create a visible vertical line of discontinuous
          </li>
        </ul>
        <ol start="3">
          <li>Make sure that pixels removed are <em>adjacent</em> to each other
          </li>
        </ol>
        <ul>
          <li>[CORRECT]
          </li>
          <li>After selecting one pixel, select one of the 3 pixels below it.
          </li>
          <li>Pick first pixel:
            <ul>
              <li>dynamic programming
              </li>
              <li>minimize cost from first row to each pixel of the next row
              </li>
              <li>for each pixel, we have a <code>prev</code>, and a minimized accumulative cost
              </li>
              <li>at the last row, find the smallest accumulative cost, and follow the <code>prev</code>s back up to generate the path to be cut.
              </li>
            </ul>
          </li>
        </ul>
        <p>
          <strong>Enlarging the image with the same algorithm</strong>
        </p>
        <p>
          Duplicate paths, from the lowest cost path to higher ones in the <strong>original image</strong>.
        </p>
        <p>
          But this is less well-defined. Because we need to add details, there are many complications. The one rule is not to duplicate the same path over and over again.
        </p>
        <h2 id="patch-march">
          Patch March
        </h2>
        <ul>
          <li>look at the hole’s boundary
          </li>
          <li>find patches in the image that matches the best with the boundary’s patches
          </li>
          <li>fill the area with the patches inwards
          </li>
        </ul>
        <h3 id="find-one-patch">
          find one patch
        </h3>
        <ul>
          <li>||patch - image||
          </li>
          <li>||patch.gradient - image.gradient||
          </li>
        </ul>
        <h3 id="the-whole-hole">
          the whole hole
        </h3>
        <p>
          It is only after the hole is filled, do we know whether this is done well.
        </p>
        <p>
          It works well when there are plenty of similar patterns, it will work well.
        </p>
        <p>
          Removing a part of a critical component, nose from the face for example, cannot work.
        </p>
        <h3 id="random-selection-of-patches">
          random selection of patches
        </h3>
        <p>
          Randomly replacing patches with better patches, until the whole patched area is smoothly integrated.
        </p>
        <p>
          Because there are too many choices, we use randomized search to iteratively improve the patch quality.
        </p>
        <p>
          Heuristics, for example interpolated color gradient, can be used as an initial guess.
        </p>
        <p>
          Another improvement could be giving the algorithm more images to draw patches from.
        </p>
        <h3 id="applications">
          applications
        </h3>
        <ul>
          <li>remove whole persons from the scene
          </li>
          <li>replace a person from the scene
          </li>
        </ul>
        <h3 id="computer-detection-of-tempering">
          computer detection of tempering
        </h3>
        <ul>
          <li>Although human cannot see some anomalies, computers can detect them
          </li>
          <li>3D Geometric features:
            <ul>
              <li>shadow length / light source angle
              </li>
            </ul>
          </li>
        </ul>
        <div>
          <a class="tag" href="/tags/graphics">graphics</a> <a class="tag" href="/tags/notes">notes</a>
        </div>
        <footer>
          <p id="cc">
            This work is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0 <img alt="Creative Commons License CC BY-SA 4.0" src="/images/cc-all.svg" style="height:1.4em; width: auto;" loading="lazy" width="30" height="11"></a>
          </p>
        </footer>
      </article>
    </main>
    <footer>
      <nav>
        <a class="icon-prefix rss" href="/index.xml">RSS</a> <a class="icon-prefix brand-github" href="https://github.com/PowerSnail/">Github</a> <a class="icon-prefix mail" href="mailto:hj@powersnail.com">hj@powersnail.com</a>
      </nav>
      <div>
        © PowerSnail 2016
      </div>
    </footer>
  </body>
</html>
