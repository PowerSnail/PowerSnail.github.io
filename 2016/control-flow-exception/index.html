<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="PowerSnail">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#af3000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="theme-color" content="#bd1b37">
    <title>
      Exceptional Control Flow · SnailShell
    </title>
    <meta property="og:title" content="Exceptional Control Flow">
    <meta property="og:site_name" content="SnailShell">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://powersnail.com/2016/control-flow-exception/">
    <meta property="og:image" content="https://powersnail.com/icons/snail.svg">
    <meta name="description" content="Reading Notes on CSAPP">
    <meta property="og:description" content="Reading Notes on CSAPP">
    <link rel="canonical" href="https://powersnail.com/2016/control-flow-exception/">
    <script type="text/javascript" id="MathJax-script" src="/js/bundle.39b4c9e45c7f60379025444391711d5dc496457cd3480b1edb45bf24649fd217.js" defer></script>
    <link id="main-css" rel="stylesheet" href="/css/style.css">
    <link rel="prefetch" href="/images/front-cover.webp" as="image" crossorigin="">
    <link rel="preload" as="font" href="/fonts/crimson-text.woff2" type="font/woff2" crossorigin="">
  </head>
  <body>
    <header>
      <article>
        <nav class="site-nav">
          <a href="/" class="site-title nav-link">SnailShell</a> <a href="/posts/" class="nav-link">Posts</a> <a href="/about/" class="nav-link">About</a>
        </nav>
      </article>
    </header>
    <main>
      <article id="post-main">
        <h1>
          Exceptional Control Flow
        </h1>
        <div id="title-subtitle">
          Reading Notes on CSAPP
        </div>
        <hr>
        <div class="metadata">
          <time datetime="2016-11-15T00:00:00Z">15 Nov 2016</time> · 1834 words · 9 minutes read
        </div>
        <h2 id="overview">
          Overview
        </h2>
        <p>
          A processor accesses a sequence of instructions when it operates. The transition from one to the next, is called <em>control transfer</em>. The sequence of transfers is called <em>control flow</em>. The control flow is smooth when the transitions are always to the adjacent address. Operations such as <code>jump</code>, <code>call</code>, etc. will cause the control flow to be abrupt.
        </p>
        <p>
          There are other situations where the control flow is abruptly changed. For example, hardware timer, network packet arrival, etc. are events that have to be dealt with but not necessarily a part of the execution of the program. The system will likely deal with such situations with <em>exceptional control flow</em> (ECF), a disruption to the control flow.
        </p>
        <ul>
          <li>Application Level ECF: inter-process <em>signal</em>
          </li>
          <li>OS kernel Level ECF: context switches
          </li>
        </ul>
        <h2 id="exceptions">
          Exceptions
        </h2>
        <h3 id="definition">
          Definition
        </h3>
        <p>
          An <em>exception</em> is an abrupt change in the control flow in response to some change in the processor’s state.
        </p>
        <p>
          An <em>event</em> is a change in the processor’s state.
        </p>
        <h3 id="exception-happening">
          Exception Happening
        </h3>
        <p>
          When the application is executing instruction $I_{curr}$, there is an event occurred.
        </p>
        <p>
          The event could be either caused by the instruction just occurred, or completely unrelated to the application. The processor will look up the <em>exception table</em>, and make a procedure call to the <em>exception handler</em>, which will process the particular kind of event. Then, depending on the event, three things can occur:
        </p>
        <ol>
          <li>The handler returns, to $I_{curr}$
          </li>
          <li>The handler returns, to $I_{next}$
          </li>
          <li>The handler aborts the program
          </li>
        </ol>
        <h3 id="exception-handling">
          Exception Handling
        </h3>
        <p>
          The handling of exception involves both hardware and software.
        </p>
        <p>
          Each type of exception is assigned an integer <em>exception number</em>, assigned by:
        </p>
        <ul>
          <li>The designer of the processor
            <ul>
              <li>divide by zero
              </li>
              <li>page faults
              </li>
              <li>memory access violations
              </li>
              <li>break-points
              </li>
              <li>arithmetic overflows
              </li>
            </ul>
          </li>
          <li>The OS kernel
            <ul>
              <li>system calls
              </li>
              <li>signals from external I/O devices
              </li>
            </ul>
          </li>
        </ul>
        <p>
          At <strong>Boot time</strong>, the OS creates the exception table, mapping each exception number to the address of the exception handler for the particular type of exception.
        </p>
        <p>
          The table’s base address is contained in a CPU register, <em>exception table base register</em>.
        </p>
        <p>
          At <strong>Run time</strong>, the processor detects the event, and determines the exception number $k$. Then it makes an indirect procedure call through the address in table[$k$].
        </p>
        <p>
          The procedure call is accompanied by a few operations:
        </p>
        <ul>
          <li>The processor pushes the address of $I_{curr}$ or $I_{next}$ on to the <strong>kernel stack</strong>
          </li>
          <li>the control is transferred to the kernel, which means the exception handlers run in <strong>kernel mode</strong>, that they have access to all system resources.
          </li>
        </ul>
        <p>
          The return is a special operation <code>return from interrupt</code>, which restores kernel mode to user mode.
        </p>
        <h3 id="class-of-exceptions">
          Class of Exceptions
        </h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>
                  Class
                </th>
                <th>
                  Cause
                </th>
                <th>
                  Async/Sync
                </th>
                <th>
                  Return behavior
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  Interrupt
                </td>
                <td>
                  Signal from I/O device
                </td>
                <td>
                  Async
                </td>
                <td>
                  Always returns to next instruction
                </td>
              </tr>
              <tr>
                <td>
                  Trap
                </td>
                <td>
                  Intentional exception
                </td>
                <td>
                  Sync
                </td>
                <td>
                  Always returns to next instruction
                </td>
              </tr>
              <tr>
                <td>
                  Fault
                </td>
                <td>
                  Potentially recoverable error
                </td>
                <td>
                  Sync
                </td>
                <td>
                  Might return to current instruction
                </td>
              </tr>
              <tr>
                <td>
                  Abort
                </td>
                <td>
                  Nonrecoverable error
                </td>
                <td>
                  Sync
                </td>
                <td>
                  Never returns
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <p>
          Table 1: Classes of Exceptions <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
        </p>
        <p>
          <em>Async</em>: means that the event (IO Interrupt) is not caused by execution of any instruction, but rather an asynchronous signal that an external IO device sends to the processor.
        </p>
        <h4 id="interrupt-handling">
          Interrupt Handling
        </h4>
        <p>
          The handling of interrupt runs independent of the program. It is not caused by, has no impact on the current program. The processor notices the interrupt pin is set, and jumps to the interrupt handler. The handler will return to $I_{next}$, as though nothing has happened.
        </p>
        <h4 id="traps-and-system-calls">
          Traps and System Calls
        </h4>
        <p>
          Traps are intentional exceptions, likely to help interface between user program and the kernel, which is a <em>system call</em>. Trap handlers also return to $I_{next}$ like interrupt handlers.
        </p>
        <p>
          System Calls:
        </p>
        <ul>
          <li>
            <code>read</code>: file reading
          </li>
          <li>
            <code>fork</code>: create a new process
          </li>
          <li>
            <code>execve</code>: loading a new program
          </li>
          <li>
            <code>exit</code>: terminating the current process
          </li>
        </ul>
        <p>
          Remember that syscall runs in kernal mode and is thus different from normal procedure calls.
        </p>
        <h4 id="faults">
          Faults
        </h4>
        <p>
          Faults are error conditions that a handler might be able to correct. If the error is corrected, the handler will return to $I_{curr}$ (the faulting instruction), so it is re-executed. Otherwise, the handler will return to an abort routine to terminate the program
        </p>
        <h4 id="aborts">
          Aborts
        </h4>
        <p>
          Aborts result from unrecoverable fatal errors, for example, DRAM bits corruption.
        </p>
        <h3 id="example-exceptions-in-linuxx86-64-systems">
          Example Exceptions in Linux/x86-64 Systems
        </h3>
        <ul>
          <li>
            <strong>Divide error</strong>: divide by zero, usually ends up in <code>abort</code>. (Floating exceptions)
          </li>
          <li>
            <strong>General protection fault</strong>: usually because the program references an undefined area of virtual memory, or tries to write to read-only text segment. Usually ends up in <code>abort</code>. (Segmentation Fault)
          </li>
          <li>
            <strong>Page Fault</strong>: Page of virtual memory is not resident in memory, needs to be retrieved from disk. The exception is <code>fault</code>, and the handler will re-execute the faulting instruction after loading the page.
          </li>
          <li>
            <strong>Machine check</strong>: Fatal hardware error is detected during execution of the faulting instruction. It directly goes to <code>abort</code>.
          </li>
        </ul>
        <p>
          Syscalls:
        </p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>
                  Number
                </th>
                <th>
                  Name
                </th>
                <th>
                  Description
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  0
                </td>
                <td>
                  <code>read</code>
                </td>
                <td>
                  Read file
                </td>
              </tr>
              <tr>
                <td>
                  1
                </td>
                <td>
                  <code>write</code>
                </td>
                <td>
                  write file
                </td>
              </tr>
              <tr>
                <td>
                  2
                </td>
                <td>
                  <code>open</code>
                </td>
                <td>
                  open file
                </td>
              </tr>
              <tr>
                <td>
                  3
                </td>
                <td>
                  <code>close</code>
                </td>
                <td>
                  close file
                </td>
              </tr>
              <tr>
                <td>
                  4
                </td>
                <td>
                  <code>stat</code>
                </td>
                <td>
                  Get info about file
                </td>
              </tr>
              <tr>
                <td>
                  9
                </td>
                <td>
                  <code>mmap</code>
                </td>
                <td>
                  map memory page to file
                </td>
              </tr>
              <tr>
                <td>
                  12
                </td>
                <td>
                  <code>brk</code>
                </td>
                <td>
                  Reset the top the heap
                </td>
              </tr>
              <tr>
                <td>
                  32
                </td>
                <td>
                  <code>dup2</code>
                </td>
                <td>
                  copy file descriptor
                </td>
              </tr>
              <tr>
                <td>
                  33
                </td>
                <td>
                  <code>pause</code>
                </td>
                <td>
                  suspend process until signal arrives
                </td>
              </tr>
              <tr>
                <td>
                  37
                </td>
                <td>
                  <code>alarm</code>
                </td>
                <td>
                  schedule delivery of alarm signal
                </td>
              </tr>
              <tr>
                <td>
                  39
                </td>
                <td>
                  <code>getpid</code>
                </td>
                <td>
                  get process ID
                </td>
              </tr>
              <tr>
                <td>
                  57
                </td>
                <td>
                  <code>fork</code>
                </td>
                <td>
                  create process
                </td>
              </tr>
              <tr>
                <td>
                  59
                </td>
                <td>
                  <code>execve</code>
                </td>
                <td>
                  execute a program
                </td>
              </tr>
              <tr>
                <td>
                  60
                </td>
                <td>
                  <code>_exit</code>
                </td>
                <td>
                  terminate process
                </td>
              </tr>
              <tr>
                <td>
                  61
                </td>
                <td>
                  <code>wait4</code>
                </td>
                <td>
                  wait for a process to terminate
                </td>
              </tr>
              <tr>
                <td>
                  62
                </td>
                <td>
                  <code>kill</code>
                </td>
                <td>
                  send a signal to a process
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <h3 id="c-and-syscalls">
          C and Syscalls
        </h3>
        <p>
          C/C++ programs can call syscall directly. For example,
        </p>
        <div class="highlight">
          <pre class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
        </div>
        <p>
          In syscall, the syscall ID is passed in <code>%rax</code>, and arguments are passed through <code>%rdi</code>, <code>%rsi</code>, <code>%rdi</code>, <code>%r10</code>, <code>%r8</code>, <code>%r9</code>, in order.
        </p>
        <p>
          Equivalent Assembly Program
        </p>
        <div class="highlight">
          <pre class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="nf">.section</span> <span class="nv">.data</span>
</span></span><span class="line"><span class="cl"><span class="nl">string:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">.ascii</span> <span class="s">"hello, world\n"</span>
</span></span><span class="line"><span class="cl"><span class="nl">string_end:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">.equ</span> <span class="nv">len</span><span class="p">,</span> <span class="nv">string_end</span> <span class="o">-</span> <span class="nv">string</span>
</span></span><span class="line"><span class="cl"><span class="nf">.section</span> <span class="nv">.text</span>
</span></span><span class="line"><span class="cl"><span class="nf">.global</span> <span class="nv">main</span>
</span></span><span class="line"><span class="cl"><span class="nl">main:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">movq</span> <span class="kc">$</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="nb">rax</span>           <span class="err">#</span> <span class="nv">syscall</span> <span class="nv">code</span><span class="p">:</span> <span class="nv">write</span> <span class="err">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="nf">movq</span> <span class="kc">$</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>           <span class="err">#</span> <span class="nv">Arg1</span><span class="p">:</span> <span class="nv">stdout</span>
</span></span><span class="line"><span class="cl">    <span class="nf">movq</span> <span class="kc">$</span><span class="nv">string</span><span class="p">,</span> <span class="o">%</span><span class="nb">rsi</span>      <span class="err">#</span> <span class="nv">Arg2</span><span class="p">:</span> <span class="nv">string</span>
</span></span><span class="line"><span class="cl">    <span class="nf">movq</span> <span class="kc">$</span><span class="nv">len</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdx</span>         <span class="err">#</span> <span class="nv">Arg3</span><span class="p">:</span> <span class="nv">length</span>
</span></span><span class="line"><span class="cl">    <span class="nf">syscall</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">movq</span> <span class="kc">$</span><span class="mi">60</span><span class="p">,</span> <span class="o">%</span><span class="nb">rax</span>          <span class="err">#</span> <span class="nv">syscall</span> <span class="nv">code</span><span class="p">:</span> <span class="nv">_exit</span> <span class="err">=</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl">    <span class="nf">movq</span> <span class="kc">$</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>           <span class="err">#</span> <span class="nv">Arg1</span><span class="p">:</span> <span class="nv">exist</span> <span class="nv">status</span> <span class="err">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="nf">syscall</span></span></span></code></pre>
        </div>
        <h2 id="processes">
          Processes
        </h2>
        <p>
          The concept of <em>process</em> provides the illusion of
        </p>
        <ul>
          <li>our program has exclusive use of CPU and memory
          </li>
          <li>the processor executes the instructions of our program without interruption
          </li>
          <li>the code and data of the program appear to be the only objects in memory
          </li>
        </ul>
        <p>
          A process is an instance of a program in execution. This means it includes:
        </p>
        <ul>
          <li>the code in memory,
          </li>
          <li>the data in memory,
          </li>
          <li>the stack of the program
          </li>
          <li>the general-purpose registers
          </li>
          <li>the program counters
          </li>
          <li>environment variables
          </li>
          <li>the set of open file descriptors
          </li>
        </ul>
        <p>
          These states are the <em>context</em> of the program.
        </p>
        <h3 id="logical-control-flow">
          Logical Control Flow
        </h3>
        <p>
          We perceive the illusionary control flow, that registers, memory, etc. are changed step by step completely according to the instruction set of our program. This control flow is called <strong>Logical Control Flow</strong>.
        </p>
        <p>
          In reality, processes take turns to use the processor. Each process runs for a short period of time and is preempted (temporarily suspended), until the next turn.
        </p>
        <p>
          This short time period is called <em>time slice</em>.
        </p>
        <h3 id="concurrent-flows">
          Concurrent Flows
        </h3>
        <p>
          A logical flow whose execution overlaps in time with another flow is called a concurrent flow. Two flows run <em>concurrently</em>.
        </p>
        <h3 id="parallel-flows">
          Parallel Flows
        </h3>
        <p>
          The concurrent flows that run on different processor cores or computers are called <em>parallel flows</em>.
        </p>
        <h3 id="private-address-space">
          Private Address Space
        </h3>
        <p>
          The illusion that the program has exclusive use of address space is provided by <em>private address space</em>. This “space” of addresses cannot be read/written by other programs, and therefore is exclusive to the program.
        </p>
        <h3 id="user-mode-vs-kernel-mode">
          User Mode vs Kernel Mode
        </h3>
        <p>
          The OS restricts each process what instructions can be executed and what memory space can be accessed. The processor provides the capability with a <code>mode bit</code>.
        </p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>
                  <code>mode bit</code>
                </th>
                <th>
                  Mode
                </th>
                <th>
                  Instruction
                </th>
                <th>
                  Memory Space
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  1
                </td>
                <td>
                  Kernel Mode
                </td>
                <td>
                  Any Instruction
                </td>
                <td>
                  Any Memory
                </td>
              </tr>
              <tr>
                <td>
                  0
                </td>
                <td>
                  User Mode
                </td>
                <td>
                  No Privileged Instruction
                </td>
                <td>
                  No reference to code/data in kernel area
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <p>
          Privileged Instruction: <code>syscall</code> functions, including halt, change mode, I/O op, etc.
        </p>
        <h4 id="proc">
          /proc
        </h4>
        <p>
          <code>/proc</code> is a Linux file system mount of the kernal data structure. It allows the user to access general system attributes.
        </p>
        <h3 id="context-switch">
          Context Switch
        </h3>
        <p>
          The kernel maintains a context for each process. The context is the state that the kernel needs to restart a preempted process.
        </p>
        <ul>
          <li>Values of general-purpose registers,
          </li>
          <li>floating-point registers
          </li>
          <li>program counter
          </li>
          <li>user’s stack
          </li>
          <li>status registers
          </li>
          <li>kernel’s stack
          </li>
          <li>various kernel data structure
            <ul>
              <li>page table
              </li>
              <li>process table
              </li>
              <li>file table
              </li>
            </ul>
          </li>
        </ul>
        <p>
          <strong>Scheduling</strong>, deciding to preempt a process and restart a preempted process. This is handled by <strong>scheduler</strong>, a code in the kernel.
        </p>
        <p>
          The kernel can decide to switch when the process is waiting for a read. The IO device can take care of the work, so the kernel will switch to another process, until the IO device sends an interrupt signalling successful transfer of data into the memory.
        </p>
        <h2 id="system-call-error-handling">
          System Call Error Handling
        </h2>
        <p>
          When a system level function encounter an error, they return $-1$, and set the global integer variable <code>errno</code> to indicate what went wrong.
        </p>
        <p>
          An error checking fork function:
        </p>
        <div class="highlight">
          <pre class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unix_error</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="nf">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">pid_t</span> <span class="nf">Fork</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// &lt;- check for error return value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">unix_error</span><span class="p">(</span><span class="s">"Fork error"</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
        </div>
        <h2 id="signals">
          Signals
        </h2>
        <p>
          A signal is a small message that notifies a process that an event of some type has occurred in the system.
        </p>
        <h3 id="sending-signal">
          Sending Signal
        </h3>
        <p>
          The kernel sends a signal because:
        </p>
        <ul>
          <li>the kernel detects a system event
          </li>
          <li>a process invoked <code>kill</code> function
          </li>
        </ul>
        <h4 id="process-group">
          Process Group
        </h4>
        <p>
          Each process belongs to exactly one process group. By default, a child process belongs to the same group as its parent.
        </p>
        <p>
          The Process Group ID can be read/write using <code>getpgrp</code> and <code>setpgid</code>.
        </p>
        <h4 id="binkill">
          <code>/bin/kill</code>
        </h4>
        <p>
          <code>/bin/kill -9 15213</code> sends a signal 9 (SIGKILL) to process 15213.
        </p>
        <p>
          <code>/bin/kill -9 -15213</code> sends a signal 9 to ever process in group 15213
        </p>
        <h4 id="from-keyboard">
          from Keyboard
        </h4>
        <p>
          A Unix shell has at most 1 foreground job and zero or more background jobs. Typing <kbd>ctrl</kbd> + <kbd>c</kbd> causes the kernel to send SIGINT to every process in the foreground process group. <kbd>ctrl</kbd> + <kbd>z</kbd> sends SIGTSTP signal to every process in the foreground process group, which pauses them.
        </p>
        <h4 id="calling-kill-function">
          Calling <code>kill</code> function
        </h4>
        <div class="highlight">
          <pre class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">kill</span><span class="p">(</span><span class="kt">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sig</span><span class="p">)</span></span></span></code></pre>
        </div>
        <p>
          If :
        </p>
        <ul>
          <li>
            <code>pid</code> &gt; 0, send <code>sig</code> to process[<code>pid</code>]
          </li>
          <li>
            <code>pid</code> = 0, send <code>sig</code> to process group that current process belongs
          </li>
          <li>
            <code>pid</code> &lt; 0, send <code>sig</code> to process group [|<code>pid</code>|]
          </li>
        </ul>
        <h4 id="calling-alarm-function">
          Calling <code>alarm</code> function
        </h4>
        <div class="highlight">
          <pre class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">alarm</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">secs</span><span class="p">);</span></span></span></code></pre>
        </div>
        <p>
          Arranges the kernel to send SIGALRM signal to the calling process in <code>secs</code> seconds. If secs == 0, then no new alarm is scheduled.
        </p>
        <p>
          It returns the remaining seconds of previous alarm.
        </p>
        <p>
          A call of <code>alarm</code> cancels all previous <code>alarm</code>s.
        </p>
        <h3 id="receiving-signal">
          Receiving Signal
        </h3>
        <p>
          The kernel checks for any <em>pending and not blocked</em> signals, when switching a process from kernel mode to user mode, i.e. from an Interrupt, syscall, or context switching.
        </p>
        <p>
          If there is no such signals, then it will proceed to $I_{next}$. Otherwise, the kernel will choose a signal and force the process to receive it. The receipt will trigger some action, and once the action is completed, the kernel proceeds to $I_{next}$.
        </p>
        <p>
          There is a default action associated with each signal; the user program can change it by using a <code>signal</code> function
        </p>
        <div class="highlight">
          <pre class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="nf">void</span><span class="p">(</span><span class="o">*</span><span class="kt">sighandler_t</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">sighandler_t</span> <span class="nf">signal</span><span class="p">(</span><span class="kt">int</span> <span class="n">signum</span><span class="p">,</span> <span class="kt">sighandler_t</span> <span class="n">handler</span><span class="p">);</span></span></span></code></pre>
        </div>
        <p>
          Then <code>handler</code> can be SIG_IGN (ignore), SIG_DFL (default), or the address of a user-defined function, a *signal handler.
        </p>
        <footer>
          <section>
            <ol>
              <li id="fn:1">
                <p>
                  Figure 8.5, CSAPP&nbsp;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">↩︎</a>
                </p>
              </li>
            </ol>
          </section>
          <section class="footer-meta">
            <p>
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="currentcolor">
              <path fill-rule="evenodd" d="M5.25 2.25a3 3 0 00-3 3v4.318a3 3 0 00.879 2.121l9.58 9.581c.92.92 2.39 1.186 3.548.428a18.849 18.849 0 005.441-5.44c.758-1.16.492-2.629-.428-3.548l-9.58-9.581a3 3 0 00-2.122-.879H5.25zM6.375 7.5a1.125 1.125 0 100-2.25 1.125 1.125 0 000 2.25z" clip-rule="evenodd"></path></svg> <a href="/tags/computer-science">computer science</a>, <a href="/tags/notes">notes</a>, <a href="/tags/study">study</a>, <a href="/tags/csapp">csapp</a>, <a href="/tags/reading-notes">reading notes</a>
            </p>
          </section>
        </footer>
      </article>
    </main>
    <footer>
      <article>
        <div class="column-center social-list">
          <a href="/index.xml" class="social nav-link"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="20" height="20" viewbox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="5" cy="19" r="1"></circle>
          <path d="M4 4a16 16 0 0 1 16 16"></path>
          <path d="M4 11a9 9 0 0 1 9 9"></path></svg> RSS</a> / <a href="https://github.com/PowerSnail/" class="social nav-link"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="20" height="20" viewbox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg> Github</a> / <a href="mailto:hj@powersnail.com" class="social nav-link"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="20" height="20" viewbox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <rect x="3" y="5" width="18" height="14" rx="2"></rect>
          <polyline points="3 7 12 13 21 7"></polyline></svg> hj@powersnail.com</a> / <a rel="me" href="https://c.im/@powersnail" class="social nav-link"><svg class="icon" width="20" height="20" viewbox="0 0 74 79" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M73.7014 17.4323C72.5616 9.05152 65.1774 2.4469 56.424 1.1671C54.9472 0.950843 49.3518 0.163818 36.3901 0.163818H36.2933C23.3281 0.163818 20.5465 0.950843 19.0697 1.1671C10.56 2.41145 2.78877 8.34604 0.903306 16.826C-0.00357854 21.0022 -0.100361 25.6322 0.068112 29.8793C0.308275 35.9699 0.354874 42.0498 0.91406 48.1156C1.30064 52.1448 1.97502 56.1419 2.93215 60.0769C4.72441 67.3445 11.9795 73.3925 19.0876 75.86C26.6979 78.4332 34.8821 78.8603 42.724 77.0937C43.5866 76.8952 44.4398 76.6647 45.2833 76.4024C47.1867 75.8033 49.4199 75.1332 51.0616 73.9562C51.0841 73.9397 51.1026 73.9184 51.1156 73.8938C51.1286 73.8693 51.1359 73.8421 51.1368 73.8144V67.9366C51.1364 67.9107 51.1302 67.8852 51.1186 67.862C51.1069 67.8388 51.0902 67.8184 51.0695 67.8025C51.0489 67.7865 51.0249 67.7753 50.9994 67.7696C50.9738 67.764 50.9473 67.7641 50.9218 67.7699C45.8976 68.9569 40.7491 69.5519 35.5836 69.5425C26.694 69.5425 24.3031 65.3699 23.6184 63.6327C23.0681 62.1314 22.7186 60.5654 22.5789 58.9744C22.5775 58.9477 22.5825 58.921 22.5934 58.8965C22.6043 58.8721 22.621 58.8505 22.6419 58.8336C22.6629 58.8167 22.6876 58.8049 22.714 58.7992C22.7404 58.7934 22.7678 58.794 22.794 58.8007C27.7345 59.9796 32.799 60.5746 37.8813 60.5733C39.1036 60.5733 40.3223 60.5733 41.5447 60.5414C46.6562 60.3996 52.0437 60.1408 57.0728 59.1694C57.1983 59.1446 57.3237 59.1233 57.4313 59.0914C65.3638 57.5847 72.9128 52.8555 73.6799 40.8799C73.7086 40.4084 73.7803 35.9415 73.7803 35.4523C73.7839 33.7896 74.3216 23.6576 73.7014 17.4323ZM61.4925 47.3144H53.1514V27.107C53.1514 22.8528 51.3591 20.6832 47.7136 20.6832C43.7061 20.6832 41.6988 23.2499 41.6988 28.3194V39.3803H33.4078V28.3194C33.4078 23.2499 31.3969 20.6832 27.3894 20.6832C23.7654 20.6832 21.9552 22.8528 21.9516 27.107V47.3144H13.6176V26.4937C13.6176 22.2395 14.7157 18.8598 16.9118 16.3545C19.1772 13.8552 22.1488 12.5719 25.8373 12.5719C30.1064 12.5719 33.3325 14.1955 35.4832 17.4394L37.5587 20.8853L39.6377 17.4394C41.7884 14.1955 45.0145 12.5719 49.2765 12.5719C52.9614 12.5719 55.9329 13.8552 58.2055 16.3545C60.4017 18.8574 61.4997 22.2371 61.4997 26.4937L61.4925 47.3144Z" fill="inherit"></path></svg> @powersnail@c.im</a>
        </div>
        <div>
          © PowerSnail 2016
        </div>
      </article>
    </footer>
  </body>
</html>
