<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="author" content="PowerSnail" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <meta name="theme-color" content="#bd1b37" />

    <title>Making Score In URL · SnailShell</title>

    <meta property="og:title" content="Making Score In URL" />
    <meta property="og:site_name" content="SnailShell" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://powersnail.com/2022/score-in-url/"
    />

    <meta
      property="og:image"
      content="https://powersnail.com/icons/snail.svg"
    />

    <meta
      name="description"
      content="Announcing Score In URL, a sheet music editor where the content is stored in the URL."
    />
    <meta
      property="og:description"
      content="Announcing Score In URL, a sheet music editor where the content is stored in the URL."
    />

    <link rel="canonical" href="https://powersnail.com/2022/score-in-url/" />

    <link id="main-css" rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div
      style="
        height: 50px;
        width: 100%;
        grid-column: 1/-1;
        grid-template-columns: subgrid;
        background-color: #f57029ff;
        display: grid;
      "
    >
      <div style="grid-column: 3/-3; position: relative">
        <img
          src="/images/halloween.webp"
          width="256px"
          height="48px"
          style="
            position: absolute;
            left: 0;
            top: 0;
            max-width: 100%;
            height: auto;
          "
        />
      </div>
    </div>

    <header>
      <article>
        <nav class="site-nav">
          <a href="/" class="site-title">
            <span class="site-title-text">Snail's Shell</span>
          </a>
          <div class="site-title-fill"></div>
          <a href="/posts/" class="nav-link"> Posts </a>
          <details>
            <summary>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="icon"
                width="16"
                height="16"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 4.5v15m7.5-7.5h-15"
                />
              </svg>

              More
            </summary>
            <div class="site-title-more">
              <a href="/index.xml" class="nav-link"> RSS </a>
              <a href="/about/" class="nav-link"> About </a>
              <a href="/sheet-music/" class="nav-link"> Sheet Music </a>
              <a href="/stats/" class="nav-link"> Blog Stats </a>
              <a href="/cat_dot/" class="nav-link"> Moving Red Dot for Cat </a>
              <a href="/game_of_life/" class="nav-link"> Game of Life </a>
            </div>
          </details>
        </nav>
      </article>
    </header>

    <main>
      <article id="post-main">
        <h1>Making <em>Score In URL</em></h1>

        <div id="title-subtitle">
          Announcing
          <a href="https://powersnail.com/ScoreInUrl"><em>Score In URL</em></a
          >, a sheet music editor where the content is stored in the URL.
        </div>

        <div class="metadata">
          <time datetime="2022-07-29T00:00:00Z">29 Jul 2022</time>
          · 1204 words · 6 minutes read
        </div>
        <hr />

        <p>
          I&rsquo;m excited to publish my new project,
          <a href="https://powersnail.com/ScoreInUrl">Score In URL</a>, a
          simple, privacy-friendly, sheet music sharing service, where the
          entire content is encoded in the URL itself as a query parameter. It
          comes with a decent editor, the score, and the audio.
        </p>
        <h2 id="an-easy-way-to-share-musical-scores">
          An easy way to share musical scores
          <a href="#an-easy-way-to-share-musical-scores"><small>##</small></a>
        </h2>
        <p>
          The inspiration came to me when I was trying to share a little snippet
          of music on a forum. It was just a short exercise, but I wanted to
          deliver both the sheet music and the audio. Most forums don&rsquo;t
          natively support sharing any form of sheet music notation, apart from
          just using an image. But to open up a composing program, export to an
          image, upload that image to Imgur, and finally share that link just
          for a one-line snippet, it&rsquo;s tedious, and it&rsquo;s an
          overkill. More importantly, an image has no sound. For that, there are
          more hoops to jump through.
        </p>
        <p>
          I already knew that abcjs has an editor in browser that can play
          audio, so what I did was asking them to go to
          <a href="https://www.abcjs.net/abcjs-editor.html">the abcjs editor</a
          >, and then, copy &amp; paste my snippet in there. It works;
          there&rsquo;s image and there&rsquo;s sound, but it&rsquo;s kinda
          awkward that they have to manually fill in the score, rather than
          opening a link with the right content already there.
        </p>
        <p>
          Something came to my mind:
          <a href="https://hashify.me/">hashify</a> is a website which encodes a
          Markdown document in its URL. Pretty brilliant idea.
        </p>
        <p>
          So, I decided to build something similar for ABC Notation. It allows
          you to enter plain text music just like <em>abcjs editor</em>, while
          the whole text is encoded into the URL, just like <em>hashify</em>.
          All you need to do is copy the URL to your friend, and they get the
          source, the sheet music, and audio in a single click. It doesn&rsquo;t
          get any simpler than that.
        </p>
        <h2 id="static-server-less-privacy-friendly">
          Static, server-less, privacy-friendly
          <a href="#static-server-less-privacy-friendly"><small>##</small></a>
        </h2>
        <p>
          Since there&rsquo;s no need to store any file, the project can be
          entirely server-less. All it takes is a base64 decoder and abcjs,
          which can all be done in the frontend. This is why I&rsquo;ve decided
          to use the query parameter, eliminating the need for server-side
          routing. The page takes a single parameter <code>s</code>, which
          contains the encoded score.
        </p>
        <div class="highlight">
          <pre
            class="chroma"
          ><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">decodeScore</span><span class="p">()</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">encoded</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s2">&#34;s&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">encoded</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">atob</span><span class="p">(</span><span class="nx">encoded</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;URL not valid. Showing default score...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">DEFAULT_SCORE</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">encodeScore</span><span class="p">(</span><span class="nx">content</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">encoded</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="s2">&#34;s&#34;</span><span class="p">,</span> <span class="nx">encoded</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
        </div>
        <p>
          The code for <em>Score In URL</em> is
          <a href="https://github.com/PowerSnail/ScoreInUrl">here</a>. Bundled
          by [vite.js], everything compiles down to a pair of HTML and JS file.
          No backend, no cookies, no tracking, no storage. It lives entirely
          inside that one browser tab.
        </p>
        <p>
          This approach has its own caveat: size limit. URLs are traditionally
          at most 2048 characters. How many pages of sheet music you get from
          those 2048 characters depend on your score, but the spirit of
          <strong>Score In URL</strong> is to share short snippets of sheet
          music, not to be a full-fledged music editor. There are much better
          tools out there for composing.
        </p>
        <h2 id="abc-notation-and-abcjs">
          ABC Notation and abcjs
          <a href="#abc-notation-and-abcjs"><small>##</small></a>
        </h2>
        <p>
          ABC Notation is possibly the most hand-writable plain text format for
          composing sheet music. Most engraving software are WYSIWYG (What You
          See Is What You Get), which means you are directly interacting with
          the score, requiring a graphical interface. For a composer sitting in
          front of their workstation, this is fine, but it&rsquo;s too heavy for
          building a quick, shareable snippet of music. On the other end of the
          spectrum, ABC Notation is just plain text. For something simple of a
          few measures long, it does the job better than any other system.
        </p>
        <p>
          Not unlike how people already do in forums, you simply write out the
          note names: <code>CDEFGAB</code>. Capital letters denote the range
          from <code>C4~B4</code>, lower case letters give you an octave higher,
          and to get more than that range, put a <code>'</code> after the note
          to raise an octave, and a <code>_</code> to lower one. Note length is
          simple math: you define a unit length in the beginning, for instance,
          with <code>L: 1/16</code>, <code>C</code> is a 16th note,
          <code>C2</code> is an 8th note, <code>C/2</code> is a 32nd note, and
          <code>C3/2</code> is a dotted 16th note.
        </p>
        <p>To write a simple C Major scale:</p>
        <div class="highlight">
          <pre
            class="chroma"
          ><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">T: C Major Scale
</span></span><span class="line"><span class="cl">L: 1/16
</span></span><span class="line"><span class="cl">M: 2/4
</span></span><span class="line"><span class="cl">C2DE FGAB | c2de fgab | c&#39;2ba gfed | c2BA GFED | C8</span></span></code></pre>
        </div>
        <p>The result looks like:</p>
        <figure>
          <img
            src="/2022/score-in-url/c_maj.webp"
            alt="The rendered score of C Major Scale"
            srcset="
              /2022/score-in-url/c_maj-400w.webp   400w,
              /2022/score-in-url/c_maj-600w.webp   600w,
              /2022/score-in-url/c_maj-800w.webp   800w,
              /2022/score-in-url/c_maj-1000w.webp 1000w,
              /2022/score-in-url/c_maj.webp       1200w
            "
            width="1200"
            height="230"
          />

          <figcaption></figcaption>
        </figure>
        <p>
          You can visit
          <a
            href="https://powersnail.com/ScoreInUrl/?s=VDogQyBNYWpvciBTY2FsZQpMOiAxLzE2Ck06IDIvNApDMkRFIEZHQUIgfCBjMmRlIGZnYWIgfCBjJzJiYSBnZmVkIHwgYzJCQSBHRkVEIHwgQzg%3D"
            >this link</a
          >
          to see and hear the C Major scale on <strong>Score In URL</strong>. Or
          a number of other examples:
          <a
            href="https://powersnail.com/ScoreInUrl/?s=VDogUGFydGl0YSBJSUkgLSBQcmVsdWRpbwpDOiBKLlMuIEJhY2gKUTogMS80PTEyMApNOiAzLzQKTDogMS8xNgpLOiBFbWFqCnoyIGUnZCcgZScyYjJnMmIyIHwgKGVmZWQgZTIpQjJHMkIyIHwgRUJGQiBHQkFCIEdCRkIgfApFZWRjIEJlZGMgQkFHRiAgICB8IEVCRkIgR0JBQiBHQkZCICB8IEVlZGMgQmVkYyBCQUdGIHwKRUZHQSBCY2RlIGZnYWYgICAgfCBnYmVmIGdhYmMnIGQnZSdjJ2QnICB8IGUnYmFiIGdiYWIgZ2JmYiB8CmVlJ2QnYycgYmVjJ2UgYmVhZXwgZ2JmYiBnYmFiIGdiZmIgIHwgZWUnZCdjJyBiZWMnZSBiZWFlIHwKZ2VlZWRlZWVmZWRlIHwgZWVnZWZlZ2VhZWZlIHwgZ2VlZWRlZWVmZWRlIHwKZWVnZWZlZ2VhZWZlIHwgZ2VnZSBnZWdlIGdlZ2UgfCBnZWdkIGdlZ2QgZ2VnZCB8CmdlZz1kIGdlZ2QgZ2VnZCB8IGFlYWMgYWVhYyBhZWFjIHwgYWVhQiBhZWFCIGFlYUIgfApnZWdCIGdlZ0IgZ2VnQiB8IGdlZ0EgZ2VnQSBnZWdBIHwgZmVmQSBmZWZBIGZlZkEgfApmZWZHIGZlZkcgZmVmRyB8IGVlZUcgZWVlRyBlZWVHIHwgZWVlRiBlZWVGIGVlZUYgfApkZWRGIGRlZEYgZGVkRiB8IEVGRUYgR0JFRiBHQkVGIHwgR0FHQSBCZUdBIEJlR0EgfA%3D%3D"
            >First page of Bach&rsquo;s Preludio</a
          >,
          <a
            href="https://powersnail.com/ScoreInUrl/?s=VDogQWlyIG9uIEcgU3RyaW5nCkM6IEouUy4gQmFjaCAoYXJyLiBBdWd1c3QgV2lsaGVsbWouKQpROiAiTGVudG8iCk06IDQvNApMOiAxLzE2Cks6IENtYWoKfDogRTE2LSB8IEUyKEFGIERDQixDKSAoIXRyaWxsIUIsNy8yQSwvMikgRyw0IHwgRzgtIEcoRV9CLEEsKSAoRF5DKShHRikgfCAKRjgtIEYoREEsRywpIChDQiwpKEZFKSB8IChFNiBeRkcpIChDMkMvMkQvMkUpIChFRCkoREMpIHwgKEIsQSwpKEEsLzJCLC8yQykgKEMyQixBLCkgRyw4IDp8IAp8OiAoQiw0LUIsQy8yQiwvMkEsLzJCLC8yRywpIChHNiBfQiwyKSB8IChBLDJBMi0gQSkoR0ZFKSB7L0V9RjQtIEYvMihFLzJELzJDLzJCLEEsKSB8IF5HLEEsKEIsMi0gQixDKShEMi0gREUpRjItIEYyRTIgfAooREMpKEIsQSwpIChCLEMvMkQvMkNCLCkgQSw4IHwgKEM0LSBDRURDKSAoQTYgR15GKSB8ICh7L0V9REdHLDIpIChBLDNCLC8yQy8yKSAoQiw3LzJBLC8yKSBHLDQgfCAKQzYgKEVEKSBENiAoRkUpIHwgRTYgKEdGKSBGOCB8IEcsNC0gRyxCLERGIEZERTItIEUyKEVGLzJHLzIpIHwgCihDNC0gQ0VHX0IpIChCMiBBNCBDMikgfCAoQixEIEY0IEEsMikgKEcsMkRFLzJGLzItIEYpKEUyRCB8IEMvMkIsLzIpKEEsMkIsKSAoQiwyey9BLH1CLEMpIEM4IDp8Cg%3D%3D"
            >Air on G String</a
          >.
        </p>
        <p>
          To learn more about writing ABC notation, visit their
          <a href="https://abcnotation.com/">official website</a>. There are
          plenty of examples and an exhaustive documentation. For quick
          references, this
          <a href="http://www.stephenmerrony.co.uk/uploads/ABCquickRefv0_6.pdf"
            >cheat sheet</a
          >
          is superb.
        </p>
        <p>
          Thanks to <a href="https://www.abcjs.net/">abcjs</a>, it&rsquo;s super
          easy to embed such a system in a web page. Abcjs provides rendering,
          audio, and error messages which integrate nicely with CodeMirror, the
          text editor.
        </p>
        <h2 id="text-editing">
          Text Editing
          <a href="#text-editing"><small>##</small></a>
        </h2>
        <p>
          To provide some rudimentary code highlighting, and more importantly,
          ergonomic error reporting,
          <a href="https://codemirror.net/">CodeMirror</a> is used. You can see
          the errors marked by red dots, like a real text editor used by
          programmers.
        </p>
        <figure>
          <img
            src="/2022/score-in-url/Screenshot_error.webp"
            alt="Screenshot showcasing error reporting"
            srcset="
              /2022/score-in-url/Screenshot_error-400w.webp   400w,
              /2022/score-in-url/Screenshot_error-600w.webp   600w,
              /2022/score-in-url/Screenshot_error-800w.webp   800w,
              /2022/score-in-url/Screenshot_error-1000w.webp 1000w,
              /2022/score-in-url/Screenshot_error-1200w.webp 1200w,
              /2022/score-in-url/Screenshot_error.webp       1702w
            "
            width="1702"
            height="346"
            loading="lazy"
          />

          <figcaption></figcaption>
        </figure>
        <p>
          The code highlighting is still not comprehensive at the moment.
          I&rsquo;ve merely written a few tokenization rules at this point, and
          certainly will improve on that in the future.
        </p>
        <h2 id="not-in-the-scope">
          Not in the scope
          <a href="#not-in-the-scope"><small>##</small></a>
        </h2>
        <p>
          I&rsquo;ve decided against using a compression algorithm. A simple
          base64 encoder is available everywhere, whereas compression requires a
          3rd party library, and might be subject to the specific quirks of that
          implementation. If the compression has a bug, it infects every URL
          shared from <strong>Score In URL</strong>. If that algorithm ever gets
          an update that is not backwards-compatible, all the old URLs are
          screwed. Furthermore, if <strong>Score In URL</strong> disappears, a
          plain base64 string is simple to use: just copy &amp; paste into any
          base64 decoder. It requires no programming skill, no tool chains, no
          setup. On the other hand, a compressed string is much harder to
          decode, especially if the user has no convenient way of installing the
          exact version of the compression algorithm I used.
        </p>
        <p>
          Despite the existence of a &ldquo;Print&rdquo; button, printing likely
          won&rsquo;t be perfect, especially if you have more than one page of
          scores. Again, the project is meant for sharing snippets of music, not
          for typesetting a multipage score. The whole thing is rendered on to a
          single image, and as long as that image looks alright in the browser,
          that&rsquo;s all it matters to me.
        </p>
        <h2 id="to-do">
          To Do
          <a href="#to-do"><small>##</small></a>
        </h2>
        <p>There are a few improvements on my mind.</p>
        <p>
          First, the code highlighting should be improved. I should at least
          tokenize all the operators.
        </p>
        <p>
          Second, there should be a synchronized cursor between the code editor
          and the score. In other words, when you are editing the plain text
          file, you should be able to see where you are on the engravings.
        </p>
        <p>
          Third, some UI adjustments. I&rsquo;m not satisfied with the way the
          buttons are laid out. It doesn&rsquo;t feel entirely intuitive, and is
          certainly something that I&rsquo;ll need some feedback on. There are
          also some strange bugs with iOS Safari, especially in landscape mode.
        </p>

        <footer>
          <section class="footer-meta">
            <p>
              <svg
                aria-label="tags"
                class="icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                width="16"
                height="16"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.25 2.25a3 3 0 00-3 3v4.318a3 3 0 00.879 2.121l9.58 9.581c.92.92 2.39 1.186 3.548.428a18.849 18.849 0 005.441-5.44c.758-1.16.492-2.629-.428-3.548l-9.58-9.581a3 3 0 00-2.122-.879H5.25zM6.375 7.5a1.125 1.125 0 100-2.25 1.125 1.125 0 000 2.25z"
                  clip-rule="evenodd"
                />
              </svg>
              <a href="/tags/computer-science"><code>computer science</code></a
              >, <a href="/tags/frontend"><code>frontend</code></a>
            </p>
          </section>

          <section>
            <p>
              Leave a comment via email:
              <a href="mailto:comment.2022.score-in-url@powersnail.com"
                >comment.2022.score-in-url@powersnail.com</a
              >.
            </p>
          </section>
        </footer>
      </article>
    </main>
    <footer>
      <article><div>© PowerSnail 2022</div></article>
    </footer>
  </body>
</html>
